<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Ñ–æ—Ä–º—ã Telegram</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #007bff; color: white; padding: 12px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin-top: 20px; padding: 15px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
    <h1>üîß –¢–µ—Å—Ç —Ñ–æ—Ä–º—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram</h1>
    
    <div class="info">
        <h3>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</h3>
        <ol>
            <li>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –Ω–∏–∂–µ</li>
            <li>–ù–∞–∂–º–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç"</li>
            <li>–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –ª–æ–≥–æ–≤</li>
            <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à Telegram</li>
        </ol>
    </div>

    <form id="testForm">
        <div class="form-group">
            <label for="name">–ò–º—è:</label>
            <input type="text" id="name" name="name" value="–¢–µ—Å—Ç–æ–≤—ã–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å" required>
        </div>
        
        <div class="form-group">
            <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
            <input type="tel" id="phone" name="phone" value="+7 918 040-04-02" required>
        </div>
        
        <div class="form-group">
            <label for="comment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</label>
            <textarea id="comment" name="comment" rows="3">–¢–µ—Å—Ç–∏—Ä—É—é —Ñ–æ—Ä–º—É –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–æ–∫</textarea>
        </div>
        
        <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç</button>
    </form>

    <div id="result"></div>

    <script>
        document.getElementById('testForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const resultDiv = document.getElementById('result');
            const formData = {
                name: document.getElementById('name').value,
                phone: document.getElementById('phone').value,
                comment: document.getElementById('comment').value
            };

            console.log('üöÄ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ:', formData);
            
            resultDiv.innerHTML = '<div class="info">–û—Ç–ø—Ä–∞–≤–ª—è–µ–º...</div>';

            try {
                // –°–Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∏—Ä—É–µ–º API —Å—Ç–∞—Ç—É—Å
                console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º API —Å—Ç–∞—Ç—É—Å...');
                const testResponse = await fetch('/api/test-telegram');
                const testData = await testResponse.json();
                console.log('üìä API —Å—Ç–∞—Ç—É—Å:', testData);

                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—Ä–æ—Å
                console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞—è–≤–∫—É...');
                const response = await fetch('/api/send-telegram', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                const responseData = await response.json();
                console.log('üì• –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', responseData);

                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h3>‚úÖ –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!</h3>
                            <p>–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ Telegram. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à–∏ —Å–æ–æ–±—â–µ–Ω–∏—è.</p>
                            <p><strong>ID —Å–æ–æ–±—â–µ–Ω–∏—è:</strong> ${responseData.messageId || '–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω'}</p>
                        </div>
                    `;
                } else {
                    throw new Error(responseData.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞:', error);
                resultDiv.innerHTML = `
                    <div class="error">
                        <h3>‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏</h3>
                        <p><strong>–°–æ–æ–±—â–µ–Ω–∏–µ:</strong> ${error.message}</p>
                        <p><strong>–ß—Ç–æ –¥–µ–ª–∞—Ç—å:</strong> –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</p>
                    </div>
                `;
            }
        });

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º API –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', async function() {
            console.log('üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ API...');
            try {
                const response = await fetch('/api/test-telegram');
                const data = await response.json();
                console.log('üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∏:', data);
                
                if (data.success) {
                    console.log('‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
                } else {
                    console.log('‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ —Å API:', data.error);
                }
            } catch (error) {
                console.log('‚ùå API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:', error.message);
            }
        });
    </script>
</body>
</html>
