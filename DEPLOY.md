# Деплой

Ниже две опции для деплоя: на Timeweb (S3-совместимое хранилище) и на Vercel.

## Деплой на Timeweb (Object Storage, статика)

Этот проект — SPA на Vite, его удобно раздавать как статические файлы через Timeweb Cloud Object Storage (S3-совместимое хранилище) с включённым статическим хостингом.

### Шаги в Timeweb

1. Создайте бакет в Object Storage и включите Static Website Hosting.
2. Установите:
   - Index document: `index.html`
   - Error document: `index.html` (для SPA-роутинга)
3. Включите публичный доступ к бакету или сконфигурируйте публичный CDN на него.
4. Сохраните значения для GitHub Secrets:
   - `TW_S3_ENDPOINT` — эндпоинт S3 (например, `https://s3.timeweb.cloud`)
   - `TW_S3_BUCKET_NAME` — имя бакета
   - `TW_ACCESS_KEY_ID` — Access Key ID
   - `TW_SECRET_ACCESS_KEY` — Secret Access Key
   - (опционально) `TW_AWS_REGION` — регион для подписи (если требуется), иначе по умолчанию `us-east-1`

### GitHub Actions

В репозитории добавлен workflow `.github/workflows/deploy-timeweb.yml`.

- Триггеры: push в ветку `main` и ручной запуск (workflow_dispatch)
- Действия: сборка `npm ci && npm run build` и загрузка содержимого `dist/` в бакет Timeweb через `aws s3 sync` с кастомным `--endpoint-url`

После установки секретов изменения будут автоматически публиковаться при каждом пуше в `main`.

### Кеширование (опционально)

Для агрессивного кеширования ассетов (JS/CSS с хешами) и некешируемых HTML можно раскомментировать дополнительные команды в workflow, устанавливающие разные заголовки `Cache-Control`.

## Деплой на Vercel

Этот проект настроен для автоматического деплоя на Vercel. Следуйте этим инструкциям:

## Быстрый деплой

1. **Подключите GitHub репозиторий к Vercel:**
   - Перейдите на [vercel.com](https://vercel.com)
   - Войдите через GitHub
   - Нажмите "New Project"
   - Выберите ваш репозиторий
   - Нажмите "Deploy"

2. **Vercel автоматически определит настройки:**
   - Framework: Vite
   - Build Command: `npm run build`
   - Output Directory: `dist`
   - Install Command: `npm install`

## Настройки проекта

### Конфигурация Vercel (`vercel.json`)
- ✅ Настроен SPA роутинг (все маршруты перенаправляются на `index.html`)
- ✅ Оптимизированы заголовки кэширования для статических ресурсов
- ✅ Указаны правильные команды сборки и развертывания

### Оптимизация сборки (`vite.config.ts`)
- ✅ Настроено разделение кода (code splitting)
- ✅ Vendor чанк для React библиотек
- ✅ UI чанк для Radix UI компонентов

### Переменные окружения
- Создайте файл `.env.local` на основе `.env.example`
- В настройках Vercel добавьте переменные окружения в разделе "Environment Variables"
- Все переменные для Vite должны начинаться с `VITE_`

## Ручной деплой через CLI

```bash
# Установите Vercel CLI
npm i -g vercel

# Войдите в аккаунт
vercel login

# Деплой
vercel

# Деплой в production
vercel --prod
```

## Полезные команды

```bash
# Локальная разработка
npm run dev

# Сборка для production
npm run build

# Предпросмотр production сборки
npm run preview
```

## Возможные проблемы и решения

### 404 ошибки при прямом переходе на маршруты
- ✅ Решено: настроен rewrite в `vercel.json`

### Медленная загрузка
- ✅ Решено: настроено разделение кода в `vite.config.ts`
- ✅ Решено: настроено кэширование статических ресурсов

### Переменные окружения не работают
- Убедитесь, что переменные начинаются с `VITE_`
- Добавьте их в настройки проекта Vercel
- Пересоберите проект после добавления переменных

## Автоматические деплои

- ✅ Каждый push в `main` ветку автоматически деплоится в production
- ✅ Pull requests создают preview деплои
- ✅ Можно настроить деплой из других веток в настройках проекта